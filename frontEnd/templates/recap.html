<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©capitulatif - {{ saison.nom_saison if saison else 'Erreur' }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../static/css/styles.css">
    <link rel="stylesheet" href="../../static/css/dark-mode.css">
    <link rel="stylesheet" href="../../static/css/animations.css">
    <style>
        .recap-table th, 
        .recap-table td {
            padding: 0.35rem 0.5rem !important; 
            font-size: 0.9rem;
            vertical-align: middle !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            height: 40px;
        }

        .recap-table {
            background-color: transparent !important;
            margin-bottom: 0 !important;
        }

        .recap-table tbody tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.05) !important;
        }

        .award-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        
        @keyframes moaiPulse {
            0%, 100% {
                filter: drop-shadow(0 0 8px rgba(160, 160, 160, 0.6));
            }
            50% {
                filter: drop-shadow(0 0 25px rgba(255, 255, 255, 1.0));
            }
        }

        .moai-icon {
            display: inline-block;
            font-size: 3rem;
            animation: moaiPulse 4s ease-in-out infinite;
        }
        
        .award-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}

    <section class="hero is-small is-dark">
        <div class="hero-body">
            <div class="container has-text-centered">
                {% if saison %}
                    <h1 class="title is-1 glow-text">{{ saison.nom_saison }}</h1>
                    <p class="subtitle is-4 has-text-grey-light">R√©capitulatif de la saison</p>
                {% else %}
                    <h1 class="title is-1 has-text-danger">Saison introuvable</h1>
                    <a href="/" class="button is-primary mt-4">Retour √† l'accueil</a>
                {% endif %}
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            {% if saison %}
                
                <div class="columns is-variable is-6 mb-6">
                    <div class="column is-6">
                        <div class="card glass-card fade-in">
                            <header class="card-header">
                                <p class="card-header-title is-centered has-text-warning">
                                    <i class="fas fa-trophy mr-2"></i> Classement par Points
                                </p>
                            </header>
                            <div class="card-content p-0">
                                <table class="table is-fullwidth recap-table has-text-light">
                                    <thead>
                                        <tr>
                                            <th class="has-text-centered" style="width: 50px;">#</th>
                                            <th>Joueur</th>
                                            <th class="has-text-right">Pts</th>
                                            <th class="has-text-centered">Victoires</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for j in saison.classement_points %}
                                        <tr>
                                            <td class="has-text-centered font-weight-bold">
                                                {% if loop.index == 1 %}ü•á{% elif loop.index == 2 %}ü•à{% elif loop.index == 3 %}ü•â{% else %}{{ loop.index }}{% endif %}
                                            </td>
                                            <td>{{ j.nom }}</td>
                                            <td class="has-text-right has-text-weight-bold">{{ j.total_points }}</td>
                                            <td class="has-text-centered">{{ j.victoires }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="column is-6">
                        <div class="card glass-card fade-in" style="animation-delay: 0.2s">
                            <header class="card-header">
                                <p class="card-header-title is-centered has-text-info">
                                    <i class="fas fa-chart-line mr-2"></i> Performance Moyenne
                                </p>
                            </header>
                            <div class="card-content p-0">
                                <table class="table is-fullwidth recap-table has-text-light">
                                    <thead>
                                        <tr>
                                            <th class="has-text-centered" style="width: 50px;">#</th>
                                            <th>Joueur</th>
                                            <th class="has-text-right">Moy. Pts</th>
                                            <th class="has-text-right">Pos. Moy.</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for j in saison.classement_moyenne %}
                                        <tr>
                                            <td class="has-text-centered font-weight-bold">{{ loop.index }}</td>
                                            <td>{{ j.nom }}</td>
                                            <td class="has-text-right has-text-weight-bold">{{ j.moyenne_points }}</td>
                                            <td class="has-text-right">{{ j.moyenne_position }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                {% set vic_cond = saison.victory_condition %}
                {% set winner_data = saison.awards[vic_cond] if vic_cond and saison.awards[vic_cond] else None %}
                
                {% if winner_data %}
                <div class="columns is-centered mb-6 fade-in" style="animation-delay: 0.3s">
                    <div class="column is-6"> 
                        <div class="card glass-card" style="background: linear-gradient(180deg, rgba(30,41,59,0.8) 0%, rgba(59,130,246,0.15) 100%); border: 1px solid rgba(255,215,0,0.3);">
                            <div class="card-content has-text-centered py-5">
                                <p class="heading has-text-warning mb-2 is-size-7">Vainqueur de la Saison</p>
                                
                                <div class="moai-icon mb-3">üóø</div>
                                
                                <h2 class="title is-3 has-text-white glow-text mb-6">{{ winner_data.nom }}</h2>
                                
                                <p class="subtitle is-6 has-text-light is-italic">
                                    {% if vic_cond == 'stakhanov' %}
                                        a accumul√© <strong class="has-text-warning">{{ winner_data.val }} points</strong> au cours de cette saison.
                                    {% elif vic_cond == 'champion' %}
                                        a remport√© <strong class="has-text-warning">{{ winner_data.val }} victoires</strong> cette saison.
                                    {% elif vic_cond == 'stonks' %}
                                        a r√©alis√© une progression fulgurante de <strong class="has-text-success">+{{ '%0.3f'| format(winner_data.val) }}</strong> points TS.
                                    {% elif vic_cond == 'pas_loin' %}
                                        a fait preuve de r√©gularit√© avec <strong class="has-text-grey-light">{{ winner_data.val }} secondes places</strong>.
                                    {% elif vic_cond == 'not_stonks' %}
                                        a surv√©cu malgr√© une chute de <strong class="has-text-danger">{{ '%0.3f'| format(winner_data.val) }}</strong> points.
                                    {% else %}
                                        a remport√© le titre sur la cat√©gorie <strong>{{ vic_cond|capitalize }}</strong>.
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <div class="box glass-card mt-6 fade-in" style="animation-delay: 0.4s">
                    <h2 class="title is-4 has-text-centered has-text-white mb-5">
                        <i class="fas fa-medal mr-2"></i> Autres Awards
                    </h2>
                    
                    <div class="columns is-multiline is-centered">
                        
                        {% if 'stakhanov' in saison.awards and saison.victory_condition != 'stakhanov' %}
                        <div class="column is-4">
                            <div class="card has-background-transparent border-light h-100">
                                <div class="card-content has-text-centered">
                                    <div class="award-icon has-text-warning">
                                        <i class="fas fa-hammer"></i>
                                    </div>
                                    <p class="heading has-text-light">Stakhanoviste</p>
                                    <p class="is-size-7 mb-2">(Le plus de points marqu√©s)</p>
                                    {% if saison.awards.stakhanov %}
                                        <p class="title is-4 has-text-white">{{ saison.awards.stakhanov.nom }}</p>
                                        <p class="award-value has-text-warning">{{ saison.awards.stakhanov.val }} pts</p>
                                    {% else %}
                                        <p class="has-text-grey">-</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if 'champion' in saison.awards and saison.victory_condition != 'champion' %}
                        <div class="column is-4">
                            <div class="card has-background-transparent border-light h-100">
                                <div class="card-content has-text-centered">
                                    <div class="award-icon has-text-warning">
                                        <i class="fas fa-crown"></i>
                                    </div>
                                    <p class="heading has-text-light">Champion</p>
                                    <p class="is-size-7 mb-2">(Le plus de victoires)</p>
                                    {% if saison.awards.champion %}
                                        <p class="title is-4 has-text-white">{{ saison.awards.champion.nom }}</p>
                                        <p class="award-value has-text-grey-lighter">{{ saison.awards.champion.val }} Victoires</p>
                                    {% else %}
                                        <p class="has-text-grey">-</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if 'pas_loin' in saison.awards and saison.victory_condition != 'pas_loin' %}
                        <div class="column is-4">
                            <div class="card has-background-transparent border-light h-100">
                                <div class="card-content has-text-centered">
                                    <div class="award-icon has-text-grey-light">
                                        <i class="fas fa-medal"></i>
                                    </div>
                                    <p class="heading has-text-light">C'√©tait pas loin</p>
                                    <p class="is-size-7 mb-2">(Le plus de 2√®me places)</p>
                                    {% if saison.awards.pas_loin %}
                                        <p class="title is-4 has-text-white">{{ saison.awards.pas_loin.nom }}</p>
                                        <p class="award-value has-text-grey-light">{{ saison.awards.pas_loin.val }}x 2√®me</p>
                                    {% else %}
                                        <p class="has-text-grey">-</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                    </div>

                    <div class="columns is-centered mt-4">
                        
                        {% if 'stonks' in saison.awards and saison.victory_condition != 'stonks' %}
                        <div class="column is-5">
                            <div class="card has-background-transparent border-light">
                                <div class="card-content">
                                    <div class="level">
                                        <div class="level-item has-text-centered">
                                            <div>
                                                <div class="award-icon has-text-success">
                                                    <i class="fas fa-chart-line"></i>
                                                </div>
                                                <p class="heading has-text-light">Stonks</p>
                                                <p class="is-size-7 mb-2">(Meilleure progression TS)</p>
                                                {% if saison.awards.stonks %}
                                                    <p class="title is-4 has-text-white">{{ saison.awards.stonks.nom }}</p>
                                                    <p class="award-value has-text-success">+{{ '%0.3f'| format(saison.awards.stonks.val) }}</p>
                                                {% else %}
                                                    <p class="has-text-grey">Aucun √©ligible</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if 'not_stonks' in saison.awards and saison.victory_condition != 'not_stonks' %}
                        <div class="column is-5">
                            <div class="card has-background-transparent border-light">
                                <div class="card-content">
                                    <div class="level">
                                        <div class="level-item has-text-centered">
                                            <div>
                                                <div class="award-icon has-text-danger">
                                                    <i class="fas fa-chart-line" style="transform: scaleY(-1);"></i>
                                                </div>
                                                <p class="heading has-text-light">Not Stonks</p>
                                                <p class="is-size-7 mb-2">(Plus grosse chute TS)</p>
                                                {% if saison.awards.not_stonks %}
                                                    <p class="title is-4 has-text-white">{{ saison.awards.not_stonks.nom }}</p>
                                                    <p class="award-value has-text-danger">{{ '%0.3f'| format(saison.awards.not_stonks.val) }}</p>
                                                {% else %}
                                                    <p class="has-text-grey">Aucun √©ligible</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                    </div>
                </div>

            {% endif %}
        </div>
    </section>

    {% include 'footer.html' %}

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fadeElems = document.querySelectorAll('.fade-in');
            fadeElems.forEach(elem => {
                elem.classList.add('visible');
            });
        });
    </script>
</body>
</html>
